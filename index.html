<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PulsePredict — Deriv Volatility Analyzer</title>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0547c1, #09e639);
      color: #333;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem 1.5rem;
      background: rgba(22, 214, 12, 0.7);
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 6px rgba(220, 5, 5, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }
    .nav-left { font-size: 1.2rem; font-weight: bold; }
    .nav-right { display: flex; align-items: center; gap: 0.8rem; }
    .flag-circle {
      width: 32px; height: 32px; border-radius: 50%;
      overflow: hidden; display: flex; align-items: center; justify-content: center;
      box-shadow: 0 0 4px rgba(0,0,0,0.3);
    }
    .flag-circle img { width: 100%; height: 100%; object-fit: cover; }
    .balance { font-weight: bold; }
    main {
      max-width: 920px;
      margin: 5rem auto 1rem;
      display: flex; flex-direction: column; gap: 1rem;
      padding: 0 1rem;
    }
    .card {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(8px);
      border-radius: 16px;
      padding: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .volatility-options { display: flex; justify-content: center; flex-wrap: wrap; gap: 0.5rem; }
    .pill {
      padding: 0.5rem 1rem; border-radius: 20px; border: 1px solid #ccc;
      cursor: pointer; transition: all 0.3s; background: white;
    }
    .pill.active { background: #007bff; color: white; border-color: #007bff; box-shadow: 0 0 6px rgba(0,123,255,0.6); }
    .volatility-display { text-align: center; margin-top: 0.5rem; font-size: 1.2rem; font-weight: bold; position: relative; }
    .volatility-display::after {
      content: ''; display: block; width: 50px; height: 3px; background: #007bff;
      margin: 0.5rem auto 0; border-radius: 2px; animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100% {opacity: 0.3;} 50% {opacity: 1;} }

    /* Oval display style */
    .current-number {
      margin: 0.5rem auto;
      width: 80px;
      height: 40px;
      border-radius: 40px / 20px;
      background: #007bff;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2rem;
      box-shadow: 0 0 8px rgba(0,0,255,0.5);
    }

    .digits {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
      gap: 1rem; justify-items: center;
    }
    .digit {
      width: 70px; height: 70px; border-radius: 50%; border: 2px solid #ccc;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      position: relative; transition: all 0.3s; background: white;
    }
    .digit .value { font-size: 1.2rem; font-weight: bold; }
    .digit .percent { font-size: 0.8rem; }
    .digit.green {border-color: green; box-shadow: 0 0 8px green;}
    .digit.pink {border-color: deeppink; box-shadow: 0 0 8px deeppink;}
    .digit.low {border-color: red; box-shadow: 0 0 15px red;}
    .digit.highlight::before {
      content: ''; position: absolute; top: -6px; left: -6px;
      width: calc(100% + 12px); height: calc(100% + 12px);
      border-radius: 50%; border: 3px solid blue; box-shadow: 0 0 10px blue;
      animation: highlight 1s infinite alternate;
    }
    @keyframes highlight { from {transform: scale(1);} to {transform: scale(1.05);} }
    .prediction-card { text-align: center; font-size: 1.5rem; font-weight: bold; min-height: 2rem; }
    .match-button {
      display: block; margin: 0.5rem auto; padding: 0.8rem 2rem;
      border: none; border-radius: 25px; background: #1005d5; color: white;
      font-size: 1.1rem; cursor: pointer; transition: background 0.3s;
    }
    .match-button:hover { background: #87a407; }
    .speedbot input { width: 100px; padding: 0.3rem; border-radius: 8px; border: 1px solid #ccc; text-align: right; }
    .speedbot-row { display: flex; justify-content: space-between; margin-bottom: 0.5rem; align-items: center; }
    .run-button {
      padding: 0.6rem 1.5rem; border: none; border-radius: 20px;
      background: #ff0000; color: white; cursor: pointer; font-weight: bold;
    }
    .toast { margin-top: 0.5rem; font-size: 0.9rem; color: green; }
    .history { font-size: 0.85rem; margin-top: 0.5rem; }
    .reset-button {
      margin-top: 0.5rem;
      padding: 0.4rem 1rem;
      border: none;
      border-radius: 12px;
      background: #444;
      color: white;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .reset-button:hover { background: #222; }
  </style>
</head>
<body>
  <nav>
    <div class="nav-left">PulsePredict — Deriv Volatility Analyzer</div>
    <div class="nav-right">
      <div class="flag-circle">
        <img src="https://flagcdn.com/w320/us.png" alt="US Flag"/>
      </div>
      <div class="balance" id="balance">USD 11.00</div>
    </div>
  </nav>
  <main>
    <div class="card">
      <div class="volatility-options" id="volatility-options"></div>
      <div class="volatility-display" id="volatility-display">Volatility — 10 1s</div>
      <!-- Oval display for current highlighted number -->
      <div class="current-number" id="current-number">0</div>
    </div>
    <div class="card">
      <div class="digits" id="digits"></div>
    </div>
    <div class="card prediction-card" id="prediction"></div>
    <button class="match-button" id="matchBtn">MATCH</button>
    <div class="card speedbot">
      <h3>SPEEDBOT</h3>
      <div class="speedbot-row"><label>STAKE</label><input type="number" id="stake"/></div>
      <div class="speedbot-row"><label>TAKE PROFIT</label><input type="number" id="tp"/></div>
      <div class="speedbot-row"><label>STOP LOSS</label><input type="number" id="sl"/></div>
      <div class="speedbot-row"><label>MARTINGALE</label><input type="number" id="martingale"/></div>
      <div class="speedbot-row"><label>PREDICTION</label><input type="text" id="predInput"/></div>
      <button class="run-button" id="runBtn">RUN</button>
      <div class="toast" id="toast"></div>
      <div class="history" id="history"></div>
      <button class="reset-button" id="resetBtn">RESET HISTORY</button>
    </div>
  </main>
  <script>
    const balanceEl = document.getElementById("balance");
    let balance = 11.00;

    const volatilityOptions = ["10 1s","15 1s","30 1s","50 1s","75 1s","90 1s","100 1s"];
    const volContainer = document.getElementById("volatility-options");
    const volDisplay = document.getElementById("volatility-display");
    volatilityOptions.forEach((opt,i)=>{
      const btn=document.createElement("div");
      btn.textContent=opt;
      btn.className="pill"+(i===0?" active":"");
      btn.onclick=()=>{
        document.querySelectorAll(".pill").forEach(p=>p.classList.remove("active"));
        btn.classList.add("active");
        volDisplay.textContent="Volatility — "+opt;
      };
      volContainer.appendChild(btn);
    });

    const digitsContainer=document.getElementById("digits");
    let percentages=generateUniqueDistribution();
    let digitEls=[];

    function generateUniqueDistribution(){
      let arr=[];
      for(let i=0;i<10;i++){
        let val;
        do {
          val = 7.2 + Math.random() * (14.0-7.2);
        } while(arr.some(x=>Math.abs(x-val)<0.05)); // ensure uniqueness ≥0.05 apart
        arr.push(val);
      }
      let sum=arr.reduce((a,b)=>a+b,0);
      arr=arr.map(x=>x/sum*100);
      return arr;
    }

    function renderDigits(){
      digitsContainer.innerHTML="";
      digitEls=[];
      percentages.forEach((p,i)=>{
        const d=document.createElement("div");
        d.className="digit";
        d.innerHTML=`<div class="value">${i}</div><div class="percent">${p.toFixed(1)}%</div>`;
        digitsContainer.appendChild(d);
        digitEls.push(d);
      });
      updateColors();
    }
    function updateColors(){
      let maxIdx=percentages.indexOf(Math.max(...percentages));
      let minIdx=percentages.indexOf(Math.min(...percentages));
      let secondIdx=[...percentages].map((v,i)=>({v,i})).sort((a,b)=>b.v-a.v)[1].i;
      digitEls.forEach((el,i)=>el.className="digit");
      digitEls[maxIdx].classList.add("green");
      digitEls[secondIdx].classList.add("pink");
      digitEls[minIdx].classList.add("low");
    }
    renderDigits();

    let currentIndex=0;
    const currentNumEl = document.getElementById("current-number");
    let interval = setInterval(moveCircle,1000);

    function moveCircle(){
      digitEls.forEach(el=>el.classList.remove("highlight"));
      digitEls[currentIndex].classList.add("highlight");
      currentNumEl.textContent = currentIndex;
      let nextIndex = Math.floor(Math.random() * 10);
      currentIndex = nextIndex;
    }

    document.getElementById("matchBtn").onclick=()=>{
      let weights = percentages.map((p,i)=>({i, w:p}));
      let total = weights.reduce((a,b)=>a+b.w,0);
      let r = Math.random()*total;
      let acc=0, chosen=0;
      for(let obj of weights){
        acc+=obj.w;
        if(r<=acc){chosen=obj.i;break;}
      }
      document.getElementById("prediction").textContent=`Prediction: ${chosen} (Conf ~${(percentages[chosen]).toFixed(1)}%)`;
      document.getElementById("predInput").value = chosen; // show in speedbot box

      // force circle to land on chosen within 3s
      setTimeout(()=>{
        currentIndex = chosen;
        moveCircle();
      },3000);
    };

    document.getElementById("runBtn").onclick=()=>{
      let stake=parseFloat(document.getElementById("stake").value);
      if(isNaN(stake)||stake<=0){alert("Invalid stake");return;}
      setTimeout(()=>{ // wait 3 seconds before executing trade
        let profit=stake*7.4;
        balance+=profit;
        balanceEl.textContent="USD "+balance.toFixed(2);
        document.getElementById("toast").textContent="Trade Successful!";
        let hist=document.getElementById("history");
        let entry=new Date().toLocaleTimeString()+" | Stake: "+stake+" | Profit: "+profit.toFixed(2)+" | Bal: "+balance.toFixed(2);
        hist.innerHTML=entry+"<br>"+hist.innerHTML;
        setTimeout(()=>{document.getElementById("toast").textContent="";},2000);
      },3000);
    };

    // RESET button clears history
    document.getElementById("resetBtn").onclick=()=>{
      document.getElementById("history").innerHTML="";
    };
  </script>
</body>
</html>
